
DDoS攻击
======
## 目录
* [DDoS攻击介绍](#ddos攻击介绍)
	* [DDoS攻击特点](#ddos攻击特点)
	*  [DDoS攻击分类](#ddos攻击分类)
* [TCP攻击](#tcp攻击)
	* [SYN Flood 攻击](#syn-flood-攻击)
	*  [SYN-ACK Flood 攻击](#syn-ack-flood-攻击)
	*  [ACK Flood 攻击](#ack-flood-攻击)
	* [FIN/RST 攻击](#finrst-flood-攻击)
	* [连接耗尽攻击](#连接耗尽攻击)

DDOS攻击介绍
------
DDoS(Distributed Denial of Service)，即分布式拒绝服务，前身为DoS（Denial of Service），即拒绝服务。最基本的DoS攻击就是攻击者利用大量合理的服务请求来占用攻击目标过多的服务资源，从而使合法用户无法得到服务的响应。DoS攻击一般是采用一对一方式的，当攻击目标各项性能指标不高时（例如CPU速度低、内存小或者网络带宽小等等），它的效果是明显的。

然而随着计算机与网络技术的发展，计算机的处理能力与网络带宽迅速增长。这使得DoS攻击的困难程度大大增加了，因为攻击目标对这些恶意服务请求的“消化能力”加强了很多。既然一个单一攻击者无法使目标“拒绝服务”，那么就需要多个攻击者同时发起分布式攻击了，这时DDoS攻击也就应运而生了。DDoS攻击是指攻击者控制僵尸网络中的大量僵尸主机（即肉鸡）向攻击目标发送大流量数据，耗尽攻击目标的系统资源，导致其无法响应正常的服务请求。


### DDoS攻击特点
* 攻击发起容易，攻击者很容易从互联网获取各类DDoS攻击工具，从而发起攻击。并且，DDoS攻击者往往可以借助正常的普通软件或网站发起攻击。

* 攻击受害者防御难度大，攻击会损害受害者的金钱、服务和信誉。

### DDos攻击分类
* **泛洪攻击（Flood）**  
指攻击者通过僵尸网络、代理或直接向攻击目标发送大量的伪装的请求服务报文，最终耗尽攻击目标的资源。发送的大量报文可以是TCP的SYN和ACK报文、UDP报文、ICMP报文、DNS报文、HTTP/HTTPS报文等。
* **反射攻击**  
泛洪攻击近年来发展出的一种高级形式。反射攻击并不直接向攻击目标发起大量服务请求，而是控制僵尸网络中的海量僵尸主机伪装成攻击目标，都以攻击目标的身份向网络中的服务器发起大量服务请求。网络中的服务器会响应这些大量的服务请求，并发送大量的应答报文给攻击目标，从而造成攻击目标性能耗尽。
反射攻击大多是由UDP Flood变种而来，反射的是UDP报文，例如NTP、DNS、SSDP、SMTP、Chargen等。因为UDP的响应（Reponse）报文大小要大于请求（request）报文，这样攻击者就实现了对攻击流量的放大，攻击效果较泛洪攻击好很多。
* **畸形或特殊报文攻击**  
攻击者发送大量有缺陷或特殊控制作用的报文，从而造成主机或服务器在处理这类报文时系统崩溃。畸形报文攻击例如Smurf、Land、Fraggle、Teardrop、WinNuke攻击等。特殊控制报文攻击包括超大ICMP报文、ICMP重定向报文、ICMP不可达报文和各种带选项的IP报文攻击。
* **扫描探测类攻击**  
是一种潜在的攻击行为，并不具备直接的破坏行为，通常是攻击者发动真正攻击前的网络探测行为，例如IP地址扫描和端口扫描等。


TCP攻击
------
### SYN Flood 攻击

TCP是需要连接状态的协议，在TCP中，通信双方使用三次握手来建立一个连接，如下图所示：

![TCP三次握手](http://blog.chinaunix.net/attachment/201304/8/22312037_1365405910EROI.png)

SYN Flood指的是攻击者利用工具或者操纵僵尸主机，向目标服务器发起大量的TCP SYN报文，当服务器回应SYN-ACK报文时，攻击者不再继续回应ACK报文。这样就会导致服务器上存在大量的TCP半连接，服务器的资源会被这些半连接耗尽，无法响应正常的请求。

假设一个用户向服务器发送了SYN报文后突然死机或掉线，那么服务器在发出SYN+ACK应答报文后是无法收到客户端的ACK报文的（第三次握手无法完成），这种情况下服务器端一般会重试（再次发送SYN+ACK给客户端）并等待一段时间后丢弃这个未完成的连接，这段时间的长度我们称为SYN Timeout，一般来说这个时间是分钟的数量级（大约为30秒-2分钟）；一个用户出现异常导致服务器的一个线程等待1分钟并不是什么很大的问题，但如果有一个恶意的攻击者大量模拟这种情况，服务器端将为了维护一个非常大的半连接列表而消耗非常多的资源----数以万计的半连接，即使是简单的保存并遍历也会消耗非常多的CPU时间和内存，何况还要不断对这个列表中的IP进行SYN+ACK的重试。实际上如果服务器的TCP/IP栈不够强大，最后的结果往往是堆栈溢出崩溃---即使服务器端的系统足够强大，服务器端也将忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求（毕竟客户端的正常请求比率非常之小），此时从正常客户的角度看来，服务器失去响应，这种情况我们就称作服务器端受到了SYN Flood攻击（SYN洪水攻击）。

### SYN-ACK Flood 攻击
通信双方通过三次握手建立一个TCP连接的过程中，SYN-ACK报文出现在第二次握手中，是用来确认第一次握手的。服务器收到SYN-ACK报文后，首先会判断该报文是不是属于三次握手范畴之内的报文。如果都没有进行第一次握手就直接收到了第二次握手的报文，那么就会向对方发送RST报文，告知对方其发来报文有误，不能建立连接。

SYN-ACK Flood攻击正是利用了这一点，攻击者利用工具或者操纵僵尸主机，向目标服务器发送大量的SYN-ACK报文，这些报文都属于凭空出现的第二次握手报文，服务器忙于回复RST报文，导致资源耗尽，无法响应正常的请求。

### ACK Flood 攻击
在TCP三次握手的过程中，ACK报文出现在第三次握手中，用来确认第二次握手中的SYN-ACK报文。ACK Flood攻击指的是攻击者利用工具或者操纵僵尸主机，向目标服务器发送大量的ACK报文，服务器忙于回复这些凭空出现的第三次握手报文，导致资源耗尽，无法响应正常的请求。

主机在接收到一个带有ACK标志位的数据包的时候，需要检查该数据包所表示的连接四元组（源IP，端口）是否存在，如果存在则检查该数据包所表示的状态是否合法，然后再向应用层传递该数据包。如果在检查中发现该数据包不合法，例如该数据包所指向的目的端口在本机并未开放，则主机操作系统协议栈会回应RST包告诉对方此端口不存在。这里，服务器要做两个动作：查表、回应ACK/RST。这种攻击方式显然没有SYN Flood给服务器带来的冲击大，因此攻击者一定要用大流量ACK小包冲击才会对服务器造成影响。按照我们对TCP协议的理解，随机源IP的ACK小包应该会被Server很快丢弃，因为在服务器的TCP堆栈中没有这些ACK包的状态信息。但是实际上通过测试，发现有一些TCP服务会对ACK Flood比较敏感，比如说JSP Server，在数量并不多的ACK小包的打击下，JSP Server就很难处理正常的连接请求。对于Apache或者IIS来说，10kpps的ACK Flood不构成危胁，但是更高数量的ACK Flood会造成服务器网卡中断频率过高，负载过重而停止响应。

从目前情况来看，很少有单纯使用ACK Flood进行的攻击，都会和其他攻击方法混合使用，因此，很容易产生误判。

### FIN/RST Flood 攻击

TCP交互过程中还存在FIN和RST报文，FIN报文用来关闭TCP连接，RST报文用来断开TCP连接。这两种报文也可能会被攻击者利用来发起DDoS攻击，导致目标服务器资源耗尽，无法响应正常的请求。

### 连接耗尽攻击

TCP是面向连接的协议，通信双方必须保持连接状态，并且通过确认、重传、滑动窗口等机制，保证数据传输的可靠性和稳定性。攻击者利用TCP协议的上述特点，在TCP连接上做文章，利用TCP连接来消耗被攻击目标的系统资源，这类攻击的影响也不容小觑。

例如，攻击者与被攻击目标完成三次握手后，立刻发送FIN或RST报文，释放本端连接，同时快速发起新的连接，以此来消耗被攻击目标的系统资源。又比如，攻击者与被攻击目标完成三次握手后，发送很少的报文来维持连接状态，通过这种异常的TCP连接来消耗被攻击目标的系统资源。  除此之外，攻击者还会使用一些其他的攻击手段，比如构造大量的并发连接、设置很小的TCP窗口、发送重传报文等，其目的都是消耗被攻击目标的系统资源。

### TCP异常报文攻击

TCP报文头中存在六个标志位字段，代表不同的含义，当标志位的值置为1，表示该标志位起作用。在我的[TCP报文介绍](https://github.com/ty3gx/Summer/blob/master/protocols.md#tcp)中有六个标志位（URG，ACK，PSH，RST，SYN，FIN）的详细信息介绍

这六个标志位在TCP交互过程中各司其职，标志位置1与否必须严格遵循TCP协议规范。如果不遵循规范随意将标志位置0或置1，这类报文就称为TCP异常报文。接收方处理这些异常报文时会消耗系统资源，甚至可能会导致系统崩溃。攻击者也可以利用TCP异常报文来发起DDoS攻击，向被攻击目标发送大量的构造的TCP异常报文，导致被攻击目标系统资源耗尽、网络拥塞，无法正常提供服务。

下表为一些TCP异常报文的特点：



|六个标志位全为1| 六个标志位全为0 |
|:--:|:--:|
| SYN和FIN标志位同时为1 | SYN和RST标志位同时为1 |
| FIN和RST标志位同时为1 | PSH，FIN和URG标志位同时为1 |
| 仅FIN标志位为1 | 仅URG标志位为1 |
| 仅PSH标志位为1 | 带有载荷的SYN和SYN-ACK报文 |
| SYN，RST和FIN标志位为1的分片报文 |





`参考资料：http://forum.huawei.com/enterprise/zh/thread-360365.html`
