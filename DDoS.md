
  
DDoS攻击
======
## 目录
* [DDoS攻击介绍](#ddos攻击介绍)
	* [DDoS攻击特点](#ddos攻击特点)
	*  [DDoS攻击分类](#ddos攻击分类)
* [TCP攻击](#tcp攻击)
	* [SYN Flood 攻击](#syn-flood-攻击)
	*  [SYN-ACK Flood 攻击](#syn-ack-flood-攻击)
	*  [ACK Flood 攻击](#ack-flood-攻击)
	* [FIN/RST 攻击](#finrst-flood-攻击)
	* [连接耗尽攻击](#连接耗尽攻击)
	* [TCP异常报文攻击](#tcp异常报文攻击)
* [HTTP攻击](#http攻击)
	* [HTTP Get/Post Flood 攻击](#http-getpost-flood-攻击)
	* [HTTP慢速攻击](#http慢速攻击)
* [UDP攻击](#udp攻击)
	* [UDP Flood 攻击](#udp-flood-攻击)
	* [NTP反射放大攻击](#ntp反射放大攻击)

DDOS攻击介绍
------
DDoS(Distributed Denial of Service)，即分布式拒绝服务，前身为DoS（Denial of Service），即拒绝服务。最基本的DoS攻击就是攻击者利用大量合理的服务请求来占用攻击目标过多的服务资源，从而使合法用户无法得到服务的响应。DoS攻击一般是采用一对一方式的，当攻击目标各项性能指标不高时（例如CPU速度低、内存小或者网络带宽小等等），它的效果是明显的。

然而随着计算机与网络技术的发展，计算机的处理能力与网络带宽迅速增长。这使得DoS攻击的困难程度大大增加了，因为攻击目标对这些恶意服务请求的“消化能力”加强了很多。既然一个单一攻击者无法使目标“拒绝服务”，那么就需要多个攻击者同时发起分布式攻击了，这时DDoS攻击也就应运而生了。DDoS攻击是指攻击者控制僵尸网络中的大量僵尸主机（即肉鸡）向攻击目标发送大流量数据，耗尽攻击目标的系统资源，导致其无法响应正常的服务请求。


### DDoS攻击特点
* 攻击发起容易，攻击者很容易从互联网获取各类DDoS攻击工具，从而发起攻击。并且，DDoS攻击者往往可以借助正常的普通软件或网站发起攻击。

* 攻击受害者防御难度大，攻击会损害受害者的金钱、服务和信誉。

### DDos攻击分类
* **泛洪攻击（Flood）**  
指攻击者通过僵尸网络、代理或直接向攻击目标发送大量的伪装的请求服务报文，最终耗尽攻击目标的资源。发送的大量报文可以是TCP的SYN和ACK报文、UDP报文、ICMP报文、DNS报文、HTTP/HTTPS报文等。
* **反射攻击**  
泛洪攻击近年来发展出的一种高级形式。反射攻击并不直接向攻击目标发起大量服务请求，而是控制僵尸网络中的海量僵尸主机伪装成攻击目标，都以攻击目标的身份向网络中的服务器发起大量服务请求。网络中的服务器会响应这些大量的服务请求，并发送大量的应答报文给攻击目标，从而造成攻击目标性能耗尽。
反射攻击大多是由UDP Flood变种而来，反射的是UDP报文，例如NTP、DNS、SSDP、SMTP、Chargen等。因为UDP的响应（Reponse）报文大小要大于请求（request）报文，这样攻击者就实现了对攻击流量的放大，攻击效果较泛洪攻击好很多。
* **畸形或特殊报文攻击**  
攻击者发送大量有缺陷或特殊控制作用的报文，从而造成主机或服务器在处理这类报文时系统崩溃。畸形报文攻击例如Smurf、Land、Fraggle、Teardrop、WinNuke攻击等。特殊控制报文攻击包括超大ICMP报文、ICMP重定向报文、ICMP不可达报文和各种带选项的IP报文攻击。
* **扫描探测类攻击**  
是一种潜在的攻击行为，并不具备直接的破坏行为，通常是攻击者发动真正攻击前的网络探测行为，例如IP地址扫描和端口扫描等。


TCP攻击
------
[TCP基本介绍](https://github.com/ty3gx/Summer/blob/master/protocols.md#tcp)
### SYN Flood 攻击

TCP是需要连接状态的协议，在TCP中，通信双方使用三次握手来建立一个连接，如下图所示：

![TCP三次握手](http://blog.chinaunix.net/attachment/201304/8/22312037_1365405910EROI.png)

SYN Flood指的是攻击者利用工具或者操纵僵尸主机，向目标服务器发起大量的TCP SYN报文，当服务器回应SYN-ACK报文时，攻击者不再继续回应ACK报文。这样就会导致服务器上存在大量的TCP半连接，服务器的资源会被这些半连接耗尽，无法响应正常的请求。

假设一个用户向服务器发送了SYN报文后突然死机或掉线，那么服务器在发出SYN+ACK应答报文后是无法收到客户端的ACK报文的（第三次握手无法完成），这种情况下服务器端一般会重试（再次发送SYN+ACK给客户端）并等待一段时间后丢弃这个未完成的连接，这段时间的长度我们称为SYN Timeout，一般来说这个时间是分钟的数量级（大约为30秒-2分钟）；一个用户出现异常导致服务器的一个线程等待1分钟并不是什么很大的问题，但如果有一个恶意的攻击者大量模拟这种情况，服务器端将为了维护一个非常大的半连接列表而消耗非常多的资源----数以万计的半连接，即使是简单的保存并遍历也会消耗非常多的CPU时间和内存，何况还要不断对这个列表中的IP进行SYN+ACK的重试。实际上如果服务器的TCP/IP栈不够强大，最后的结果往往是堆栈溢出崩溃---即使服务器端的系统足够强大，服务器端也将忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求（毕竟客户端的正常请求比率非常之小），此时从正常客户的角度看来，服务器失去响应，这种情况我们就称作服务器端受到了SYN Flood攻击（SYN洪水攻击）。

### SYN-ACK Flood 攻击
通信双方通过三次握手建立一个TCP连接的过程中，SYN-ACK报文出现在第二次握手中，是用来确认第一次握手的。服务器收到SYN-ACK报文后，首先会判断该报文是不是属于三次握手范畴之内的报文。如果都没有进行第一次握手就直接收到了第二次握手的报文，那么就会向对方发送RST报文，告知对方其发来报文有误，不能建立连接。

SYN-ACK Flood攻击正是利用了这一点，攻击者利用工具或者操纵僵尸主机，向目标服务器发送大量的SYN-ACK报文，这些报文都属于凭空出现的第二次握手报文，服务器忙于回复RST报文，导致资源耗尽，无法响应正常的请求。

### ACK Flood 攻击
在TCP三次握手的过程中，ACK报文出现在第三次握手中，用来确认第二次握手中的SYN-ACK报文。ACK Flood攻击指的是攻击者利用工具或者操纵僵尸主机，向目标服务器发送大量的ACK报文，服务器忙于回复这些凭空出现的第三次握手报文，导致资源耗尽，无法响应正常的请求。

主机在接收到一个带有ACK标志位的数据包的时候，需要检查该数据包所表示的连接四元组（源IP，端口）是否存在，如果存在则检查该数据包所表示的状态是否合法，然后再向应用层传递该数据包。如果在检查中发现该数据包不合法，例如该数据包所指向的目的端口在本机并未开放，则主机操作系统协议栈会回应RST包告诉对方此端口不存在。这里，服务器要做两个动作：查表、回应ACK/RST。这种攻击方式显然没有SYN Flood给服务器带来的冲击大，因此攻击者一定要用大流量ACK小包冲击才会对服务器造成影响。按照我们对TCP协议的理解，随机源IP的ACK小包应该会被Server很快丢弃，因为在服务器的TCP堆栈中没有这些ACK包的状态信息。但是实际上通过测试，发现有一些TCP服务会对ACK Flood比较敏感，比如说JSP Server，在数量并不多的ACK小包的打击下，JSP Server就很难处理正常的连接请求。对于Apache或者IIS来说，10kpps的ACK Flood不构成危胁，但是更高数量的ACK Flood会造成服务器网卡中断频率过高，负载过重而停止响应。

从目前情况来看，很少有单纯使用ACK Flood进行的攻击，都会和其他攻击方法混合使用，因此，很容易产生误判。

### FIN/RST Flood 攻击

TCP交互过程中还存在FIN和RST报文，FIN报文用来关闭TCP连接，RST报文用来断开TCP连接。这两种报文也可能会被攻击者利用来发起DDoS攻击，导致目标服务器资源耗尽，无法响应正常的请求。

### 连接耗尽攻击

TCP是面向连接的协议，通信双方必须保持连接状态，并且通过确认、重传、滑动窗口等机制，保证数据传输的可靠性和稳定性。攻击者利用TCP协议的上述特点，在TCP连接上做文章，利用TCP连接来消耗被攻击目标的系统资源，这类攻击的影响也不容小觑。

例如，攻击者与被攻击目标完成三次握手后，立刻发送FIN或RST报文，释放本端连接，同时快速发起新的连接，以此来消耗被攻击目标的系统资源。又比如，攻击者与被攻击目标完成三次握手后，发送很少的报文来维持连接状态，通过这种异常的TCP连接来消耗被攻击目标的系统资源。  除此之外，攻击者还会使用一些其他的攻击手段，比如构造大量的并发连接、设置很小的TCP窗口、发送重传报文等，其目的都是消耗被攻击目标的系统资源。

### TCP异常报文攻击

TCP报文头中存在六个标志位字段，代表不同的含义，当标志位的值置为1，表示该标志位起作用。在我的[TCP报文介绍](https://github.com/ty3gx/Summer/blob/master/protocols.md#tcp)中有六个标志位（URG，ACK，PSH，RST，SYN，FIN）的详细信息介绍

这六个标志位在TCP交互过程中各司其职，标志位置1与否必须严格遵循TCP协议规范。如果不遵循规范随意将标志位置0或置1，这类报文就称为TCP异常报文。接收方处理这些异常报文时会消耗系统资源，甚至可能会导致系统崩溃。攻击者也可以利用TCP异常报文来发起DDoS攻击，向被攻击目标发送大量的构造的TCP异常报文，导致被攻击目标系统资源耗尽、网络拥塞，无法正常提供服务。

下表为一些TCP异常报文的特点：


| - | - |
|:--:|:--:|
|六个标志位全为1| 六个标志位全为0 |
| SYN和FIN标志位同时为1 | SYN和RST标志位同时为1 |
| FIN和RST标志位同时为1 | PSH，FIN和URG标志位同时为1 |
| 仅FIN标志位为1 | 仅URG标志位为1 |
| 仅PSH标志位为1 | SYN，RST和FIN标志位为1的分片报文 |
| 带有载荷的SYN报文 |带有载荷的SYN-ACK报文|


HTTP攻击
------
### HTTP Get/Post Flood 攻击
这种攻击的原理很简单，攻击者利用攻击工具或者操纵僵尸主机，向目标服务器发起大量的HTTP GET或HTTP POST报文，请求服务器上涉及数据库操作的URI或其它消耗系统资源的URI，造成服务器资源耗尽，无法响应正常请求。

### HTTP慢速攻击
HTTP慢速攻击是利用HTTP协议的正常交互机制，先与目标服务器建立一个连接，然后长时间保持该连接不释放。如果攻击者持续与目标服务器建立这样的连接，就会使目标服务器上的可用资源耗尽，无法提供正常服务。HTTP慢速攻击主要包括针对HTTP请求报文头部结束符的Slow Headers攻击，以及针对POST请求报文数据长度的Slow POST攻击。
* **Slow Headers攻击**  
HTTP请求头部的后面会存在一个空行（结束符），其中包括回车符和换行符，从而告知服务器请求头部结束，后面不再有请求头。如果服务器没有收到这个空行则会一直保持连接。Slow Headers攻击正是利用这一点，攻击者使用GET或POST请求方法与目标服务器建立连接，然后持续发送不包含结束符的HTTP头部报文，目标服务器会一直等待请求头部中的结束符而导致连接始终被占用。如果攻击者控制大量的僵尸主机向目标服务器发起这种攻击，将会导致服务器资源耗尽，无法正常提供服务。

* **Slow POST攻击**  
Slow POST攻击利用的是POST请求方法，攻击者向目标服务器发送POST请求报文提交数据，数据的长度设置为一个很大的数值，但是在随后的数据发送中，每次只发送很小的报文，这样就是导致目标服务器一直等待攻击者发送数据。如果攻击者控制大量的僵尸主机向目标服务器发起这种攻击，将会导致服务器资源耗尽，无法正常提供服务。


UDP攻击
------
[UDP基本介绍](https://github.com/ty3gx/Summer/blob/master/protocols.md#udp)
### UDP Flood 攻击

UDP Flood是日渐猖厥的流量型DDoS攻击，原理也很简单。常见的情况是利用大量UDP小包冲击DNS服务器或Radius认证服务器、流媒体视频服务器等。100k pps的UDP Flood经常将线路上的骨干设备例如防火墙打瘫，造成整个网段的瘫痪。由于UDP协议是一种无连接的服务，在UDP Flood攻击中，攻击者可发送大量伪造源IP地址的小UDP包。但是，由于UDP协议是无连接性的，所以只要开了一个UDP的端口提供相关服务的话，那么就可针对相关的服务进行攻击。

正常应用情况下，UDP包双向流量会基本相等，而且大小和内容都是随机的，变化很大。出现UDP Flood的情况下，针对同一目标IP的UDP包在一侧大量出现，并且内容和大小都比较固定。

### NTP反射放大攻击

* **NTP：**  
NTP（Network Time Protocol），即网络时间协议。顾名思义，NTP是一种用于保证网络中的计算机时间同步的协议。NTP协议采用服务器-客户端模型，提供了高精准度的时间校正机制。在网络中，NTP客户端不以自己的时间为准，而是每隔一段时间从NTP服务器同步更新自身时间。NTP协议定义了NTP服务器的层次结构，通过逐层传播，实现时间同步。  
NTP协议中有一个监控（Monlist）功能，用于监控NTP服务器。NTP服务器会记录与自己进行过时间同步的客户端IP地址的信息，而且客户端可以通过一些命令索要这些记录。每个NTP服务器可以记录进行过时间同步的最后600个客户端的IP地址，当有客户端索要这个记录时，NTP服务器会返回这600个客户端IP地址，响应包按照每6个IP地址进行分割，最多可以返回100个响应包。

* **反射**  
反射，就是把源IP地址伪造成被攻击IP地址，利用无状态连接的UDP缺少源认证机制的特点，进行攻击。 在UDP协议中，正常情况下，客户端发送请求包到服务器，服务器返回响应包给客户端，这就完成了一次交互，中间没有校验过程。由于UDP协议不是面向连接的，所以客户端发送请求包的源IP地址很容易被篡改。一些低版本的NTP服务器没有针对源IP地址的校验机制，所以如果把请求包的源IP地址篡改为攻击目标的IP地址，最终服务器返回的响应包就会被送到攻击目标，这就是“反射”攻击。

* **放大**  
黑客通常是利用互联网的基础架构来进行放大攻击，效果更强。网络中开放的NTP服务器非常多，如果黑客利用僵尸主机，同时向NTP服务器发起大量的Monlist请求，1个Monlist请求包可以引发100个响应包。通常，1个NTP请求包只有90字节的大小，而1个回应报文通常为482字节，100个回应报文就是48200字节，回应报文是请求报文的500倍左右，这样就可以达到四两拨千斤的“放大”效果，仅使用很小的带宽达到很大的攻击流量。



`参考资料：http://forum.huawei.com/enterprise/zh/thread-360365.html`
